<html>
    <head>
        <title>Dilation Animation</title>

        <style>
            body {
                margin: 0;
            }
            canvas {
                width: 100%;
                height: 100%;
            }
        </style>
    </head>

    <body>
        <script src="js/three.js"></script>
        <script src="js/OrbitControls.js"></script>
        <script src="js/drawText.js"></script>
        <script src="js/drawCube.js"></script>

        <script>

            // for showing the frame rate, ram usage
            (function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='//mrdoob.github.io/stats.js/build/stats.min.js';document.head.appendChild(script);})()

            var drawImage = function(){
                for(y=m-1;y>=0;y--){
                    for(x=0;x<n;x++){
                        drawCube(x,y,0,0x292929);
                        drawText(x-0.18,y-0.2,0.1,imageArray[m-1-y][x],false,false);
                    }
                }
            };

            var kernelObj = [];
            var kernelText = [];

            var drawKernel = function(baseX,baseY){
                for(y=m-1;y>=m-mk;y--){
                    kernelTempObj = []
                    for(x=0;x<nk;x++){
                        var cube = drawCube(x+baseX,y+baseY,2,0x292929);
                        var content = drawText(x-0.18+baseX,y-0.2+baseY,2.1,imageArray[m-1-y][x],true,x==(nk-1));
                        kernelTempObj.push(cube);
                    }
                    kernelObj.push(kernelTempObj);
                }
            };

            var updatedPositionx=0;
            var updatedPositiony=2;
            var updateKernelPosition = function(){
                updatedPositionx = (updatedPositionx+1)%3;
                updatedPositiony = updatedPositionx==0 ? ((updatedPositiony-1)>=0 ? (updatedPositiony-1): 2): updatedPositiony;

                for(y=0;y<kernelObj.length;y++){
                    for(x=0;x<kernelObj[0].length;x++){
                        kernelObj[y][x].position.x=updatedPositionx+x;
                        kernelObj[y][x].position.y=updatedPositiony+y;
                        try{
                            kernelText[y][x].position.x=updatedPositionx+x-0.18;
                            kernelText[y][x].position.y=updatedPositiony+y-0.2;
                        }catch(err){
                            console.log('textHasNotInitialized');
                        }
                    }
                }
                console.log(kernelText);
            };

            

            var scene = new THREE.Scene();
            scene.background = new THREE.Color( 0xFFFFFF );
            var camera = new THREE.PerspectiveCamera( 75, window.innerWidth/window.innerHeight, 0.1, 1000);

            var renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight);
            document.body.appendChild( renderer.domElement);

            window.addEventListener('resize', function(){
                var width = window.innerWidth;
                var height = window.innerHeight;
                renderer.setSize( width, height);
                camera.aspect = width/height;
                camera.updateProjectionMatrix();
            });

            var imageArray = [
                ['1','1','0','0','1'],
                ['1','1','0','1','1'],
                ['1','1','0','1','0'],
                ['1','1','0','1','0'],
                ['1','1','0','1','0']];

            var kernelArray = [
                ['0','1','0'],
                ['1','1','1'],
                ['0','1','0']
            ]

            var m = imageArray.length;
            var n = imageArray[0].length;

            var mk = kernelArray.length;
            var nk = kernelArray[0].length;

            var controls = new THREE.OrbitControls(camera, renderer.domElement);

            drawImage();

            drawKernel(0,0);
            camera.position.z = 10;

            // animation logic
            var update = function(){
                
            };

            // draw scene
            var render = function(){
                renderer.render(scene, camera);
            };

            // run animation loop {update, render, repeat}
            var animationLoop = function(){
                requestAnimationFrame( animationLoop );
                update();
                render();
            };
            setInterval(updateKernelPosition, 1000);
            animationLoop();
        </script>
    </body>
</html>